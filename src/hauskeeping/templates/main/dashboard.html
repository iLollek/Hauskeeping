{% extends "base.html" %}

{% block title %}Kalender â€“ Hauskeeping{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <a href="{{ url_for('main.dashboard', week_offset=week_offset - 1) }}"
       class="btn btn-outline-secondary">
        <i class="bi bi-chevron-left"></i> Vorherige Woche
    </a>
    <h3 class="mb-0">
        {{ monday.strftime('%d.%m.') }} &ndash; {{ sunday.strftime('%d.%m.%Y') }}
        <small class="text-muted ms-1" style="font-size: 0.5em; font-weight: 400; letter-spacing: 0.04em; vertical-align: middle;">KW&nbsp;{{ calendar_week }}</small>
    </h3>
    <a href="{{ url_for('main.dashboard', week_offset=week_offset + 1) }}"
       class="btn btn-outline-secondary">
        Naechste Woche <i class="bi bi-chevron-right"></i>
    </a>
</div>

{% if week_offset != 0 %}
<div class="text-center mb-3">
    <a href="{{ url_for('main.dashboard') }}" class="btn btn-sm btn-outline-primary">
        <i class="bi bi-calendar-event"></i> Zur aktuellen Woche
    </a>
</div>
{% endif %}

<div class="row g-3">
    {% for day in days %}
    <div class="col-12 col-md-6 col-xl">
        <div class="card h-100 {% if day.is_today %}border-primary{% endif %}">
            <div class="card-header {% if day.is_today %}bg-primary text-white{% else %}bg-light{% endif %}">
                <strong>{{ day.name }}</strong>
                <span class="float-end">{{ day.date.strftime('%d.%m.') }}</span>
            </div>
            <div class="card-body p-2">
                {% if day.tasks %}
                {% for task in day.tasks %}
                <div class="card mb-2 border-start border-4"
                     style="border-left-color: {% if task.category %}{{ task.category.color }}{% else %}#6c757d{% endif %} !important;">
                    <div class="card-body p-2">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <span class="{% if task.is_done %}text-decoration-line-through text-muted{% endif %}">
                                    {{ task.title }}
                                </span>
                                {% if task.category %}
                                <br><span class="badge" style="background-color: {{ task.category.color }}20; color: {{ task.category.color }}; border: 1px solid {{ task.category.color }}40; font-size: 0.7em;">
                                    {{ task.category.name }}
                                </span>
                                {% endif %}
                                {% if task.assignee %}
                                <br><small class="text-muted">
                                    <i class="bi bi-person"></i> {{ task.assignee.username }}
                                </small>
                                {% endif %}
                            </div>
                            <form method="POST" action="{{ url_for('tasks.toggle', task_id=task.id) }}">
                                <button type="submit" class="btn btn-sm {% if task.is_done %}btn-outline-success{% else %}btn-outline-secondary{% endif %}"
                                        title="{% if task.is_done %}Als offen markieren{% else %}Als erledigt markieren{% endif %}">
                                    <i class="bi {% if task.is_done %}bi-check-circle-fill{% else %}bi-circle{% endif %}"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <p class="text-muted small text-center mb-0 py-2">Keine Aufgaben</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div class="text-center mt-4">
    <a href="{{ url_for('tasks.create') }}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Neue Aufgabe
    </a>
</div>
{% endblock %}
